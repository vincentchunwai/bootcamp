CREATE TABLE CITY(
	ID SERIAL PRIMARY KEY,
	CITY_NAME VARCHAR(20)
	)
CREATE TABLE CUSTOMER (
	ID SERIAL PRIMARY KEY,
	CUSTOMER_NAME VARCHAR(255),
	CITY_ID INTEGER REFERENCES CITY(ID),
	CUSTOMER_ADDRESS VARCHAR(255),
	CONTACT_PERSON VARCHAR(255) NULL,
	EMAIL VARCHAR(128),
	PHONE VARCHAR(128)
	)
	
CREATE TABLE PRODUCT(
	ID SERIAL PRIMARY KEY,
	SKU VARCHAR(32),
	PRODUCT_NAME VARCHAR(128),
	PRODUCT_DESCRIPTION TEXT,
	CURRENT_PRICE DECIMAL(8,2),
	QUANTITY_IN_STOCK INTEGER
	)
	
CREATE TABLE INVOICE(
	ID INTEGER PRIMARY KEY,
	INVOICE_NUMBER VARCHAR(255),
	CUSTOMER_ID INTEGER REFERENCES CUSTOMER(ID),
	USER_ACCOUNT_ID INTEGER,
	TOTAL_PRICE DECIMAL(8,2),
	TIME_ISSUED VARCHAR NULL,
	TIME_DUE VARCHAR NULL,
	TIME_PAID VARCHAR NULL,
	TIME_CANCELED VARCHAR NULL,
	TIME_REFUNDED VARCHAR NULL
	)
	
CREATE TABLE INVOICE_ITEM(
	ID SERIAL PRIMARY KEY,
	INVOICE_ID INTEGER REFERENCES INVOICE(ID),
	PRODUCT_ID INTEGER REFERENCES PRODUCT(ID),
	QUANTITY INTEGER,
	PRICE DECIMAL(8,2),
	LINE_TOTAL_PRICE DECIMAL(8,2)
	)
INSERT INTO CITY VALUES(1, 'DERBY'),
	(2, 'LEICESTER'),
	(3, 'BRISTOL'),
	(4, 'NOTTINGHAM')
	
INSERT INTO CUSTOMER VALUES(1, 'Drogerie Wien', 1, 'Deckergasse 15A', 'Emil Steinbach', 'emil@drogeriewien.com', 094234234),
	(2, 'Cosmetics Store', 4, 'Watling Street 347', 'Jeremy Corbyn', 'jeremy@c-store.org', 093923923),
	(3, 'Kosmetikstudio', 3, 'Rothenbaumchaussee 53', 'Willy Brandt', 'willy@kosmetikstudio.com', 0941562222),
	(4, 'Neue Kosmetik', 1, 'karlsplatz 2', Null, 'info@neuekosmetik.com', 094109253),
	(5, 'Bio Kosmetik', 2, 'MotzstraBe 23', 'Clara Zetkin', 'clara@biokosmetik.org', 093825825),
	(6, 'K-Wien', 1, 'Karntner StraBe 204', 'Maria Rauch-Kallat', 'maria@kwien.org', 093427002),
	(7, 'Natural Cosmetics', 4, 'Clerkenwell Road 14B', 'Glenda Jackson', 'glena.@natural-cosmetics.com', 093555123),
	(8, 'Kosmetik Plus', 2, 'Unter den Linden 1', 'Angela Merkel', 'angela@k-plus.com', 094727727),
	(9, 'New Line Cosmetics', 4, 'Devonshire Street 92', 'Oliver Cromwell', 'oliver@nic.org', 093202404)

INSERT INTO PRODUCT VALUES (1, 330120, 'Game Of Thrones - URBAN DECAY', 'Game Of Thrones Eyeshadow Palette', 65, 122),
	(2, 330121, 'Advanced Night Repair - ESTEE LAUDER', 'Advanced Night Repair Synchronized Recovery Complex II', 98, 51),
	(3, 330122, 'Rose Deep Hydration - FRESH', 'Rose Deep Hydration Facial Toner', 45, 34),
	(4, 330123, 'Pore-Perfecting Moisturizer - TATCHA', 'Pore-Perfecting Moisturizer & Cleanser Duo', 25, 393),
	(5, 330124, 'Capture Youth - DIOR', 'Capture Youth Serum Collection', 95, 74),
	(6, 330125, 'Slice of Glow - GLOW RECIPE', 'Slice of Glow Set', 45, 40),
	(7, 330126, 'Healthy Skin - KIEHL S SINCE 1851', 'Healthy Skin Squad', 68, 154),
	(8, 330127, 'Power Pair! - IT COSMETICS', 'IT is Your Skincare Power Pair! Best - Selling Moisturizer & Eye Cream Duo', 80, 0),
	(9, 330128, 'Dewy Skin Mist - TATCHA', 'Limited Edition Dewy Skin Mist Mini', 20, 281),
	(10, 330129, 'Silk Pillowcase - SLIP', 'Silk Pillowcase Duo + Scrunchies Kit', 170, 0)

INSERT INTO INVOICE VALUES (1, 'in_25181b07ba800c8d2fc967fe991807d9', 7, 4, 1436, '7/20/2019 3:50:07 PM', '7/27/2019 3:05:07 PM', '7/25/2019 9:24:12 AM', Null),
	(2, '8fba0000fd456b27502b9f81e9d52481', 9, 2, 1000, '7/20/2019 3:0711 PM', '7/27/2019 3:07:11 PM', '7/20/2019 3:10:32 PM', Null),
	(3, '3b6638118246b6bcfd3dfcd9be487599', 3, 2, 360, '7/20/2019 3:06:15 PM', '7/27/2019 3:06:15 PM', '7/31/2019 9:22:11 PM', Null),
	(4, 'dfe7f0a01a682196cac0120a9adbb550', 5, 2, 1675, '7/20/2019 3:06:34 PM', '7/27/2019 3:06:34 PM', Null, Null),
	(5, '2a24cc22ad4440d698878a0a1a71f70fa', 6, 2, 9500, '7/20/2019 3:06:42 PM', '7/27/2019 3:06:42 PM', Null, '7/22/2019 11:17:02 AM'),
	(6, 'cbd304872ca6257716bcab8fc43204d7', 4, 2, 150, '7/20/2019 3:08:15 PM', '7/27/2019 3:08:15 PM', '7/27/2019 1:42:25 PM', Null)

INSERT INTO INVOICE_ITEM VALUES (1, 1, 1, 20, 65, 1300),
	(2, 1, 7, 2, 68, 136),
	(3, 1, 5, 10, 100, 1000),
	(4, 3, 10, 2, 180, 360),
	(5, 4, 1, 5, 65, 325),
	(6, 4, 2, 10, 95, 950),
	(7, 4, 5, 4, 100, 400),
	(8, 5, 10, 100, 95, 9500),
	(9, 6, 4, 6, 25, 150)

SELECT 'CUSTOMER :'AS TYPE, C.ID AS ID, C.CUSTOMER_NAME AS NAME
FROM CUSTOMER C 
WHERE NOT EXISTS(
	SELECT *
	FROM INVOICE I
	WHERE C.ID = I.CUSTOMER_ID
)

UNION ALL

SELECT 'PRODUCT :' AS TYPE, P.ID AS ID, P.PRODUCT_NAME AS NAME
FROM PRODUCT P
WHERE NOT EXISTS(
	SELECT *
	FROM INVOICE_ITEM I
	WHERE P.ID = I.PRODUCT_ID 
)

CREATE TABLE EMPLOYEE (
	ID SERIAL NOT NULL PRIMARY KEY,
	EMPLOYEE_NAME VARCHAR(30) NOT NULL,
	SALARY NUMERIC(8,2),
	PHONE NUMERIC(15),
	EMAIL VARCHAR(50),
	DEPT_ID INTEGER NOT NULL
)

CREATE TABLE DEPARTMENT(
	ID SERIAL NOT NULL PRIMARY KEY,
	DEPT_CODE VARCHAR(3) NOT NULL,
	DEPT_NAME VARCHAR(200) NOT NULL
)

INSERT INTO EMPLOYEE VALUES (1, 'JOHN', 20000, 90234567, 'JOHN@GMAIL.COM', 1),
	(2, 'MARY', 10000, 90234561, 'MARY@GMAIL.COM', 1),
	(3, 'STEVE', 30000, 90234562, 'STEVE@GMAIL.COM', 3),
	(4, 'SUNNY', 40000, 90234563, 'SUNNY@GMAIL.COM', 4)
	
INSERT INTO DEPARTMENT VALUES (1, 'HR', 'HUMAN RESOURCES'),
	(2, '9UP', '9UP DEPARTMENT'),
	(3, 'SA', 'SALES DEPARTMENT'),
	(4, 'IT', 'INFORMATION TECHNOLOGY DEPARTMENT')


SELECT D.DEPT_CODE AS DEPARTMENT, COUNT(E.DEPT_ID) AS NUMBER_OF_EMPLOYEES
FROM EMPLOYEE E RIGHT JOIN DEPARTMENT D
ON E.DEPT_ID = D.ID
GROUP BY D.ID
ORDER BY NUMBER_OF_EMPLOYEES DESC, DEPARTMENT ASC

