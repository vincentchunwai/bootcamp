
CREATE TABLE COUNTRIES(
    COUNTRY_ID CHAR(2) NOT NULL PRIMARY KEY,
	COUNTRY_NAME VARCHAR(40) NOT NULL,
	REGION_ID SERIAL NOT NULL,
	FOREIGN KEY (REGION_ID) REFERENCES REGIONS(REGION_ID)
	)
CREATE TABLE LOCATIONS(
    LOCATION_ID SERIAL NOT NULL PRIMARY KEY,
    STREET_ADDRESS VARCHAR(25) NOT NULL,
    POSTAL_CODE VARCHAR(12) NOT NULL,
    CITY VARCHAR(30) NOT NULL,
    STATE_PROVINCE VARCHAR(12),
    COUNTRY_ID CHAR(2),
    FOREIGN KEY (COUNTRY_ID) REFERENCES COUNTRIES(COUNTRY_ID)
    )
	ALTER TABLE LOCATIONS
    ALTER COLUMN STATE_PROVINCE TYPE VARCHAR(30);

CREATE TABLE REGIONS(
	REGION_ID INTEGER NOT NULL PRIMARY KEY,
	REGION_NAME VARCHAR(25) NOT NULL
    )
CREATE TABLE DEPARTMENTS(
    DEPARTMENT_ID INTEGER PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR(30),
    MANAGER_ID INTEGER,
    LOCATION_ID INTEGER,
	FOREIGN KEY (LOCATION_ID) REFERENCES LOCATIONS(LOCATION_ID)
    )
CREATE TABLE JOB_HISTORY(
    EMPLOYEE_ID INTEGER PRIMARY KEY,
    START_DATE DATE,
    END_DATE DATE,
    JOB_ID VARCHAR(10),
    DEPARTMENT_ID INTEGER,
	FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID),
    FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID))
CREATE TABLE JOBS(
    JOB_ID VARCHAR(10) PRIMARY KEY,
    JOB_TITLE VARCHAR(35),
    MIN_SALARY INTEGER,
    MAX_SALARY INTEGER)
CREATE TABLE JOB_GRADES(
    GRADE_LEVEL VARCHAR(2) PRIMARY KEY,
    LOWEST_SAL INTEGER,
	HIGHEST_SAL INTEGER
    )
CREATE TABLE EMPLOYEES(
    EMPLOYEE_ID INTEGER PRIMARY KEY,
    FIRST_NAME VARCHAR(20),
    LAST_NAME VARCHAR(25),
    EMAIL VARCHAR(25),
    PHONE_NUMBER VARCHAR(20),
    HIRE_DATE DATE,
    JOB_ID VARCHAR(10),
    SALARY INTEGER,
    COMMISSION_PCT INTEGER,
    MANAGER_ID INTEGER,
    DEPARTMENT_ID INTEGER,
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES JOB_HISTORY(EMPLOYEE_ID),
	FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID),
	FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID)
    )
ALTER TABLE LOCATIONS
ALTER COLUMN STATE_PROVINCE DROP NOT NULL;

INSERT INTO REGIONS VALUES (1, 'WESTERN EUROPE');
INSERT INTO REGIONS VALUES (2, 'MIDWEST');
INSERT INTO REGIONS VALUES (3, 'NORTHERN EAST');
INSERT INTO COUNTRIES VALUES ('DE', 'GERMANY', 1);
INSERT INTO COUNTRIES VALUES ('IT', 'ITALY', 1);
INSERT INTO COUNTRIES VALUES ('JP', 'JAPAN', 3);
INSERT INTO COUNTRIES VALUES ('US', 'UNITED STATE', 2);
SELECT * FROM COUNTRIES;
INSERT INTO LOCATIONS (LOCATION_ID, STREET_ADDRESS, POSTAL_CODE, CITY, COUNTRY_ID) VALUES (1000, '1297 Via Cola di Rie', 989, 'ROMA', 'IT');
INSERT INTO LOCATIONS (LOCATION_ID, STREET_ADDRESS, POSTAL_CODE, CITY, COUNTRY_ID) VALUES (1100, '93091 Calle della Te', 10934, 'Venice', 'IT');
INSERT INTO LOCATIONS VALUES (1200, '2017 Shinjuku-ku', 1689, 'Tokyo', 'Tokyo Perfectu', 'JP');
INSERT INTO LOCATIONS VALUES (1400, '2014 Jabberwocky Rd', 26192, 'Southlake', 'Texas', 'US');

INSERT INTO DEPARTMENTS VALUES (10, 'Administration', 200, 1100);
INSERT INTO DEPARTMENTS VALUES (20, 'Marketing', 201, 1200);
INSERT INTO DEPARTMENTS VALUES (30, 'Purchasing', 202, 1400);

SELECT * FROM JOBS;

INSERT INTO JOBS VALUES ('IT_PROG', 'TECHNICIAN', 16000, 30000);
INSERT INTO JOBS VALUES ('MK_REP', 'LEAD', 30000, 49900);
INSERT INTO JOBS VALUES ('ST_CLERK', 'INTERN', 10000, 15000);

INSERT INTO JOB_HISTORY VALUES (102, '1990-01-13', '1998-07-24', 'IT_PROG', 20);
INSERT INTO JOB_HISTORY VALUES (101, '1989-09-21', '1993-10-27', 'MK_REP', 10);
INSERT INTO JOB_HISTORY VALUES (101, '1993-10-28', '1997-03-15', 'MK_REP', 30);
INSERT INTO JOB_HISTORY VALUES (100, '1996-02-17', '1999-12-19', 'ST_CLERK', 30);
INSERT INTO JOB_HISTORY VALUES (103, '1998-03-24', '1999-12-31', 'MK_REP', 20);

SELECT * FROM JOB_HISTORY;
SELECT * FROM DEPARTMENTS;
INSERT INTO EMPLOYEES VALUES (100, 'Steven', 'King', 'SKING', '515-1234567', '1987-06-17', 'ST_CLERK', 24000, 0.00, 109, 10)
INSERT INTO EMPLOYEES VALUES (101, 'Neena', 'Kochhar', 'NKOCHHAR', '515-1234568', '1987-06-18', 'MK_REP', 17000, 0.00, 103, 20)
INSERT INTO EMPLOYEES VALUES (102, 'Lex', 'De Haan', 'LDEHAAN', '515-1234569', '1987-06-19', 'IT_PROG', 17000, 0.00, 108, 30)
INSERT INTO EMPLOYEES VALUES (103, 'Alexander', 'Hunold', 'AHUNOLD', '590-4234567', '1987-06-20', 'MK_REP', 9000, 0.00, 105, 20)
SELECT * FROM EMPLOYEES

SELECT L.LOCATION_ID, L.STREET_ADDRESS, L.CITY, L.STATE_PROVINCE, C.COUNTRY_NAME 
FROM LOCATIONS L, COUNTRIES C
WHERE L.COUNTRY_ID = C.COUNTRY_ID;

SELECT FIRST_NAME, LAST_NAME, DEPARTMENT_ID FROM EMPLOYEES

WITH CTE AS(
  SELECT D.DEPARTMENT_ID
	FROM DEPARTMENTS D, LOCATIONS L
	WHERE D.LOCATION_ID = L.LOCATION_ID
	AND L.COUNTRY_ID = 'JP'
  )
SELECT E.FIRST_NAME, E.LAST_NAME, E.JOB_ID, D.DEPARTMENT_ID
FROM EMPLOYEES E, DEPARTMENTS D, CTE C
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND D.DEPARTMENT_ID = C.DEPARTMENT_ID

CREATE TABLE MANAGERS(
	ID INTEGER PRIMARY KEY,
    FIRST_NAME VARCHAR(20) NOT NULL,
	LAST_NAME VARCHAR(20) NOT NULL,
	MANAGER_ID INTEGER,
	FOREIGN KEY (MANAGER_ID) REFERENCES DEPARTMENTS(MANAGER_ID)
	)

ALTER TABLE DEPARTMENTS
ADD CONSTRAINT unique_manager_id UNIQUE (MANAGER_ID);
SELECT * FROM DEPARTMENTS
INSERT INTO MANAGERS VALUES (1, 'David', 'Lee', 201);
INSERT INTO MANAGERS VALUES (2, 'Whitney', 'Houston', 202);
INSERT INTO MANAGERS VALUES (3, 'Derrick', 'White', 200);

SELECT E.EMPLOYEE_ID, E.LAST_NAME, M.MANAGER_ID, M.LAST_NAME
FROM EMPLOYEES E, DEPARTMENTS D, MANAGERS M
WHERE E.DEPARTMENT_ID = D.DEPARTMENT_ID
AND M.MANAGER_ID = D.MANAGER_ID

SELECT E.EMPLOYEE_ID, E.LAST_NAME, E.HIRE_DATE
FROM EMPLOYEES E, EMPLOYEES E2
WHERE E2.LAST_NAME = 'DE HAAN'
AND E2.FIRST_NAME = 'LEX'
AND E.HIRE_DATE > E2.HIRE_DATE

SELECT D.DEPARTMENT_NAME, COUNT(1) AS NUMBER_OF_EMPLOYEES
FROM DEPARTMENTS D, EMPLOYEES E
WHERE D.DEPARTMENT_ID = E.DEPARTMENT_ID
GROUP BY D.DEPARTMENT_ID

SELECT H.EMPLOYEE_ID, J.JOB_TITLE, EXTRACT(DAY FROM AGE(H.END_DATE, H.START_DATE)) AS NUMBER_OF_DATE
FROM EMPLOYEES E, JOBS J, JOB_HISTORY H
WHERE E.EMPLOYEE_ID = H.EMPLOYEE_ID
AND E.JOB_ID = J.JOB_ID
AND H.DEPARTMENT_ID = '30'

SELECT D.DEPARTMENT_NAME, CONCAT(M.FIRST_NAME, M.LAST_NAME), L.CITY, C.COUNTRY_NAME
FROM DEPARTMENTS D, MANAGERS M, LOCATIONS L, COUNTRIES C
WHERE D.MANAGER_ID = M.MANAGER_ID
AND D.LOCATION_ID = L.LOCATION_ID
AND L.COUNTRY_ID = C.COUNTRY_ID

SELECT D.DEPARTMENT_NAME AS DEPARTMENTS, AVG(E.SALARY) AS AVERAGE_SALARY
FROM DEPARTMENTS D , EMPLOYEES E
WHERE D.DEPARTMENT_ID = E.DEPARTMENT_ID
GROUP BY D.DEPARTMENT_NAME

ALTER TABLE JOBS
ADD UNIQUE (JOB_TITLE)

SELECT * FROM JOBS

CREATE TABLE JOB_ASSIGNMENTS (
    JOB_ID VARCHAR(10),
    GRADE_LEVEL VARCHAR(2),
    FOREIGN KEY (JOB_ID) REFERENCES JOBS(JOB_ID),
    FOREIGN KEY (GRADE_LEVEL) REFERENCES JOB_GRADES(GRADE_LEVEL),
    PRIMARY KEY (JOB_ID, GRADE_LEVEL)
);

SELECT * FROM JOB_ASSIGNMENTS








	